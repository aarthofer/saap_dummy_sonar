FROM mcr.microsoft.com/dotnet/sdk:3.1 AS RestApiBuild

WORKDIR /root

COPY Apollo .

WORKDIR /root/Apollo.Web

RUN dotnet publish -o /ApolloWeb --self-contained=true -p:PublishTrimmed=true --runtime linux-x64


FROM mcr.microsoft.com/dotnet/aspnet:3.1 AS Runtime

WORKDIR /ApolloWeb

COPY --from=RestApiBuild /ApolloWeb .
COPY appsettings.json /ApolloWeb/appsettings.json

CMD ["dotnet", "Apollo.Web.dll", "--urls", "http://0.0.0.0:80"]
